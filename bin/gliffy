#!/usr/bin/ruby
#
$: << File.expand_path(File.dirname(__FILE__) + '/../lib') 
$: << File.expand_path(File.dirname(__FILE__) + '/../ext') 

require 'gliffy/cli'
require 'rubygems'
require 'gli'
include GLI

pre do |global_options,command,options,args|
  if !Gliffy::CLIConfig.instance.load
    raise "Problem loading config"
  end
  if command && command.name != :help
    previous_token = Gliffy::CLIConfig.instance.config[:current_token]
    Gliffy::Config.config.log_level = Logger::DEBUG if global_options[:v]
    $gliffy = Gliffy::Handle.new(Gliffy::CLIConfig.instance.config[:username],previous_token)
  end
end

desc 'be more verbose'
switch :v

require 'gliffy/commands'

GLI.run(ARGV)
