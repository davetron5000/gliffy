#!/usr/bin/ruby
#
$: << File.expand_path(File.dirname(__FILE__) + '/../lib') 
$: << File.expand_path(File.dirname(__FILE__) + '/../ext') 

require 'gliffy/cli'
require 'rubygems'
require 'gli'
include GLI

pre do |global_options,command,options,args|
  if global_options[:version]
    puts "#{$0} v#{Gliffy::VERSION}"
    false
  elsif !Gliffy::CLIConfig.instance.load
    puts "Problem loading config"
    false
  elsif command && command.name != :help
    previous_token = Gliffy::CLIConfig.instance.config[:current_token]
    Gliffy::Config.config.log_level = Logger::DEBUG if global_options[:v]
    $gliffy = Gliffy::Handle.new(Gliffy::CLIConfig.instance.config[:username],previous_token)
    true
  else
    true
  end
end

desc 'show version'
switch :version

desc 'be more verbose'
switch :v

require 'gliffy/commands'

GLI.run(ARGV)
